# ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples

setup_servers ()
{
	if [ ${HOSTNAME} == "talitha-borealis" ]; then
		SERVER="laptop"
		ALIAS="lap"
	elif [ ${HOSTNAME} == "ninehundred" ]; then
		SERVER="desktop"
		ALIAS="900"
	elif [ ${HOSTNAME} == "localhost" ]; then
		SERVER="davonez"
		ALIAS="dav"
	else
		# probably on a dev server
		SERVER="dev"
		ALIAS="dev"
	fi
}


setup_system ()
{
	# If not running interactively, don't do anything
	[ -z "$PS1" ] && return

	# don't put duplicate lines in the history. See bash(1) for more options
	export HISTCONTROL=ignoredups
	# ... and ignore same sucessive entries.
	export HISTCONTROL=ignoreboth

	export DISPLAY=:0.0

	# check the window size after each command and, if necessary,
	# update the values of LINES and COLUMNS.
	shopt -s checkwinsize

	# make less more friendly for non-text input files, see lesspipe(1)
	[ -x /usr/bin/lesspipe ] && eval "$(SHELL=/bin/sh lesspipe)"

	# set variable identifying the chroot you work in (used in the prompt below)
	if [ -z "$debian_chroot" ] && [ -r /etc/debian_chroot ]; then
		debian_chroot=$(cat /etc/debian_chroot)
	fi

	# If this is an xterm set the title to user@host:dir
	case "$TERM" in xterm*|rxvt*)
		PROMPT_COMMAND='echo -ne "\033]0;${USER}@${HOSTNAME}: ${PWD/$HOME/~}\007"'
		;;
		*)
		;;
	esac

	# enable color support of ls and also add handy aliases
	if [ "$TERM" != "dumb" ] && [ -x /usr/bin/dircolors ]; then
		eval "`dircolors -b`"
	fi

	# enable programmable completion features (you don't need to enable
	# this, if it's already enabled in /etc/bash.bashrc and /etc/profile
	# sources /etc/bash.bashrc).
	if [ -f /etc/bash_completion ]; then
	. /etc/bash_completion
	fi
}

setup_colors ()
{
	DARK=0
	LIGHT=1

	TEXT=3
	BACKGROUND=4

	BLACK=0
	RED=1
	GREEN=2
	YELLOW=3
	BLUE=4
	PURPLE=5
	CYAN=6
	WHITE=7

	UNDERLINE=4

	ORIGINAL_COLOR=0

	export LIGHTRED="\e[${LIGHT};${TEXT}${RED}m"
	export DARKRED="\e[${DARK};${TEXT}${RED}m"
	export LIGHTGREEN="\e[${LIGHT};${TEXT}${GREEN}m"
	export DARKGREEN="\e[${DARK};${TEXT}${GREEN}m"
	export LIGHTYELLOW="\e[${LIGHT};${TEXT}${YELLOW}m"
	export LIGHTBLUE="\e[${LIGHT};${TEXT}${BLUE}m"
	export DARKBLUE="\e[${DARK};${TEXT}${BLUE}m"
	export LIGHTPURPLE="\e[${LIGHT};${TEXT}${PURPLE}m"
	export LIGHTCYAN="\e[${LIGHT};${TEXT}${CYAN}m"
	export DARKCYAN="\e[${DARK};${TEXT}${CYAN}m"

	export ORIGINAL_COLOR="\e[${ORIGINAL_COLOR}m"
}

setup_aliases ()
{
	# Personal
	alias grep='grep --color=always'
	alias tclsh="rlwrap tclsh"
	alias ls='ls -1 -X --group-directories-first --color=auto'
	alias ll='ls -lh'
	alias la='ll -A'
	alias l='ls -CF'
	alias x='exit'
	alias h='history'
	alias hg='history | grep'
	alias tailn='tail -n 450'

	alias wrap="rlwrap"

	alias gzx='gunzip -c'
	alias links='find . -type l -exec ls -l --color=auto {} \;'
	alias findn='find . -name'
	alias findr='find . -regex'
	alias ssh='ssh -X'

	alias appserv='ot_appserv'
	alias grace="sudo apache2ctl graceful"
	alias asproc='ps -ef | grep shazleto | grep [a]ppserv'

	# appserv commands, prob put these in a script for better and stuff
	alias admin='rm admin.log admin_err.log; touch admin.log; appserv admin_shazleto.cfg 2>admin_err.log & tail -f admin.log | grep -v "<ASM>"'
	alias cust='rm cust.log cust_err.log; touch cust.log; appserv cust_shazleto.cfg 2>cust_err.log & tail -f cust.log | grep -v "<ASM>"'

	# box_specific
	if [[ $SERVER == "laptop" ]]; then
		alias work='~/shaz_utils/scripts/connect_to_work.sh -ed shazleto vpn.openbet.com'
		alias hdprim='xrandr --output HDMI1 --primary'
		alias killwork="ps -ef | egrep \"[s]sh.*openbet.com\" | awk '"'{print $2}'"' | xargs sudo kill -9"
		alias killas="ps -ef | egrep \"[o]t_appserv\" | awk '"'{print $2}'"' | xargs sudo kill; ipcnuke"
		alias killas9="ps -ef | egrep \"[o]t_appserv\" | awk '"'{print $2}'"' | xargs sudo kill -9; ipcnuke"
	fi

	if [[ $SERVER == "desktop" ]]; then
		alias work='~/shaz_utils/scripts/connect_to_work.sh -d shazleto vpn.openbet.com'
		alias hdprim='xrandr --output HDMI1 --primary'
		alias killwork="ps -ef | egrep \"[s]sh.*openbet.com\" | awk '"'{print $2}'"' | xargs sudo kill -9"
		alias killas="ps -ef | egrep \"[o]t_appserv\" | awk '"'{print $2}'"' | xargs sudo kill; ipcnuke"
		alias killas9="ps -ef | egrep \"[o]t_appserv\" | awk '"'{print $2}'"' | xargs sudo kill -9; ipcnuke"
	fi

	if [[ $SERVER == "davonez" ]]; then
		alias work='~/shaz_utils/scripts/connect_to_work.sh -e shazleto vpn.openbet.com'
		alias killwork="ps -ef | egrep \"[s]sh.*openbet.com\" | awk '"'{print $2}'"' | xargs sudo kill -9"
		alias xx='exit 10'
	fi

	if [[ $SERVER == "dev" ]]; then
		alias xx='exit 10'
		alias space='cd /space/shazleto'
	fi
	
	# cvs stuff
	alias cvsd='CVSROOT=":pserver:${USER}@pserver:/cvsroot"'
	alias cvso='CVSROOT=":pserver:${USER}@pserver:/cvsroot-openbet"'
	alias cvsu='cvs -q upd'
	alias cvss='cvs stat'
	alias cvst='cvs tag'
	alias vi='vim -X'

	# rdp to live
	alias rdplive='rdesktop -u shazleton -g 1280x1024 localhost:3391'
	alias tunoff='ssh p -L3391:10.180.139.210:3389'
	alias tunon='ssh p -L3391:10.110.132.1:3389'

	# macau SLOT
	alias tunmac='ssh -A macaccess -L 9903:172.16.6.92:80'

	# system test rep
	alias sysrep='ssh newtest -nNC -L 10289:localhost:10289 -o ServerAliveInterval=60 -o ServerAliveCountMax=2 keepalive'

	# mount dumptrack
	alias cloud='mount https://dav.dumptruck.goldenfrog.com/r/giganews.com'

	# dbaccess
	alias whd='rlwrap dbaccess willhill_dev@db01_1170 -'
	alias whdold='rlwrap dbaccess willhill_dev@db01_1150 -'
}


bash_prompt_command () {

	# How many characters of the $PWD should be kept
	local pwdmaxlen=25
	# Indicate that there has been dir truncation
	local trunc_symbol=".."
	local dir=${PWD##*/}
	pwdmaxlen=$(( ( pwdmaxlen < ${#dir} ) ? ${#dir} : pwdmaxlen ))
	NEW_PWD=${PWD/#$HOME/\~}
	local pwdoffset=$(( ${#NEW_PWD} - pwdmaxlen ))
	if [ ${pwdoffset} -gt "0" ]
	then
		NEW_PWD=${NEW_PWD:$pwdoffset:$pwdmaxlen}
		NEW_PWD=${trunc_symbol}/${NEW_PWD#*/}
		PWD=${NEW_PWD}
    fi
}


setup_variables ()
{
	arch=`uname -m | sed -e 's/i.86/ix86/' -e 's/sun4./sun4/'`

	OPENBET=/prj/openbet/bin:/prj/deployment/bin:/lib:/prj/orbis/lib/${arch}
	APPSERV=/opt/appserv/current

	PATH=/local/Scripts:/usr/bin:/local/bin:$APPSERV/bin

	export JAVA=/usr/lib/jdk-1.1

	# informix
	INFORMIXSERVER=_11
	INFORMIXDIR=/opt/informix

	LD_LIBRARY_PATH=$APPSERV/lib:$INFORMIXDIR/lib:$INFORMIXDIR/lib/esql

	# deployment
	DEPLOYMENT=/prj/deployment/latest

	CLASSPATH=$CLASSPATH:$JAVA:$INFORMIXDIR/jdbc/lib/ifxjdbc-g.jar:$APACHE_HOME/jserv/JSDK2.0/lib/jsdk.jar:$PRJ/orbis-java/lib1.1/orbis.jar:$PRJ/orajava/orajava.zip:$ORACLE_HOME/jdbc/lib/classes111.zip:$NETSCAPE_DIR/java/classes/java40.jar:~/cvs_src/sig/tests:.

	PATH=$PATH:.:/local/j2re1.4.2_05/bin:/bin:/usr/local/bin:/sbin:/usr:/usr/sbin:~/bin:/usr/X11R6/bin:$INFORMIXDIR/bin:$SYBASE/bin:$ORACLE_HOME/bin:$JAVA/bin:$CCM_HOME/bin:$OPENBET:$APPSERV:$DEPLOYMENT/bin:$TLS:/local/j2re1.4.2_05/bin:/local/j2re1.4.2_05

	CVSROOT=:pserver:${USER}@pserver:/cvsroot

	export INFORMIXDIR INFORMIXSERVER PATH LD_LIBRARY_PATH DEPLOYMENT OPENBET APPSERV CVSROOT
	export TERM=xterm
	export PROMPT_COMMAND=bash_prompt_command

	export PS1='\e[1;34m$ALIAS\e[m:\[\033[m\]\[\033[01;35;1m\]\w\[\033[m\]\[\033[01;33m\]$\[\033[m\] '
}


go_home ()
{
	if [[ $SERVER == "laptop" ]]; then
		cd /space/work
	else
		cd ~/
	fi
}

setup_servers
setup_system
setup_colors
setup_variables
setup_aliases
go_home

